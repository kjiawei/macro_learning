<h1>目录</h1>
<li>零 我的待处理任务
<li>一 大致需求[具体可查看相关文档]
<li>二 项目目录结构说明[项目管理]
<li>三 开发及相关注意事项
<li>三 1/2 调试方案与测验
<li>四 调试及编译
<li>五 移植(方式 步骤)
<li>六 档案库(问题&方案讨论)
<li>七 功能讨论&后续开发

<h2>零 我的待处理任务</h2>
1./mnt/hgfs/Share/software/app-software/trunk/version.sh:-1: error: line 8: svn: command not found</br>
can系协议的分析使用</br>
理解软件与文件系统关系</br>
移植nfs(putty能否传输更新包)</br>
KTV测试方案-主控板的电导值获取与通信协议&如何获取血泵流速(我的理解:使用前先有个校正按钮进行机器调试-主页面显示需要输入的数值-输入确定后驱动下层硬件进行血泵(抽血)验证;期间要设定测试时所需的数值 有结束测试按钮)</br>
appfs.bin编译分析(rootfs.bin里的参数解析)</br>
数据库使用</br>
未解决</br>VirtualBox里文字如何复制到windows </br> 虚拟机下如何切换中文输入法</br>
项目管理学习 http://edu.csdn.net/course/detail/1837?ref=down&loc=0

<h2>一 大致需求</h2>
我对这个项目需求理解:模仿贝朗机器(用纯代码模拟高级,例如ktv的功能)</br>
界面层级划分(主界面:按了右下角显示能看到的都是 子界面(二级菜单):工具按钮[工作模式 治疗参数 高级设置 其它]  第三层:[例:按治疗参数后显示的界面[治疗时间 超滤 血泵 肝素...能在页面内直接设置内容的]]     特殊说明:主界面上的"电导度"等按钮按了也会跳转到子页面)</br>
<h3>按功能划分</h3>
<h4>消毒</h4>
<h4>治疗前参数设置</h4>
<h4>其余功能(血压测量等)</h4>
<h4>机器设定等</h4>
现行项目实现:页面逻辑不好管理;</br>  返回功能应该成为公共模块(传一个页面值和属性就能跳转到指定界面)和每个界面都有返回主界面功能;</br>
--主控系统需求: 核心板



<h2>二 项目目录结构说明</h2>
<h3>项目分析要点</h3>
<li>makefile和构建编译脚本等文件可快速了解项目概况
<li>1.1天了解项目要求及设计概览;2~3天模块了解;试着上手修改部分UI查看效果并了解调试流程和移植
<li>2.Qt图形编程之外重要的编程模块和框架:Threads、Networking、XML，Graphics view、OpenGL、SQL
<li>3.样式控制宏(分布在公共样式文件和对应类名的头文件)->宏勾画出大致样式布局
widget_common.h文件(大都设置显示样式 字体 位置,有些会设置title value和unit)
LINEEDIT_STYLE-行编辑框  LINEEDIT_SHOWSTYLE   LINENOEDIT_STYLE    COMBOBOX_STYLE-下拉列表框  
<li>scene_note里包含了数字键盘的设计
<h3>具体文件/模块</h3>
0.文件夹说明:trunk目录下的readme文件</br>
1.window_main是项目主界面介绍(内含描述关联其它模块)</br>
例如:WidgetSetupAdvanced->widget_setup_advanced.cpp</br>
2.packet.h文件里宏定义了各板间的数据通讯代码</br>
3.数据曲线是什么,包含哪些内容</br>
4.scene_ktv2是对ktv2场景的设置 ktv2是启动/暂停等功能的设置</br>
5.项目优点:用了大量宏来定义控件样式,维护起来需要看项目分析里的表</br>
6.报警模块(监控板作用):声音 灯光 文字 记录</br>
7.数据库设计</br>
disinfect_db为治疗信息表 runLog_db为运行记录表 warntable为报警表


<h2>三 开发及相关注意事项</h2>
10.21MVC开发思想会议会在我个人虚拟机上进行测试开发(在原来可以运行项目里的源码都在源同文件夹里有重命名可运行的文件,然后在原可运行文件上改)最新开发进度查看周计划及6068工作计划.xlsx里的内容,我的虚拟机的qt-creator有时会显示permission denyed导致无法运行程序,重新执行一遍就可以了;修改部署后的源码.h文件->.cpp文件->部分需要添加资源
<h3>环境搭建</h3>
原则前提:用qt5.5(个人电脑虚拟机上)开发,懂得项目4到5迁移需要改变什么东西,以及编译脚本怎么改,开发环境怎么搭建</br>
代码共享文件夹:D:\嵌入式开发\暨华-血液透析机\6068源码\公司电脑修改过来的</br>
现行:公司电脑上D:workspace目录下为同步的最新代码  公司电脑虚拟机(Fedora 20  安装应用yum install nfs)上为开发测试</br> 
开发板：移植QT库
[公司目标板:Qt Embedded目前的版本为4.8.0，可以通过下载qt-everywhere-src-opensource-4.8.0.tar.gz源代码包通过编译后得到QtEmbedded-4.8.0版，编译方法：通过在Linux命令行中进入解压后的源代码目录，在命令行中输入# ./configure -embedded arm -qvfb，#make ，#make install即可。]</br>
进度:移植未解决</br>
虚拟机(公司fedora developer asdfgqwert)</br>
移植到ubuntu:移植tslib库后在makefile文件中注释掉lts
<h4>我的电脑Ubuntu编译</h4>
全盘清理一次项目构建,.pro时的构建选择最下面的release(trunk目录下调试即可),version.h文件里为REV赋1个值,ts库保证是在虚拟机里移植成功过的
<h4>异议处理</h4>
qt creator打开失败(共享库出错):sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/libGL.so.1

<h2>三 1/2 调试方案与测验</h2>
<h3>血/水路调试</h3>

<h2>四 项目调试编译</h2>
<h3>编译流程</h3>根目录下的编译脚本分别执行子目录下的构建脚本(先应用后文件系统);文件系统里有打包工具,将先生成可运行的应用拷贝至文件系统后进行压缩/格式转换,其中构建命令中的参数有可能影响文件系统的正确与否</br>
现行编译文件系统参数说明:http://blog.csdn.net/dragon101788/article/details/17097103
<h4>脚本方式</h4>
通常用于构建嵌入式版本的软件,build.sh包含整个项目的编译流程(同样包含上位机build_app_software部分),用之前一般要先执行clean.sh</br>
make与脚本关系:make可以直接编译项目源码,执行脚本方式则包含对整个项目(uboot 内核 文件系统等)的构建,make包含于脚本命令中(技巧:make -j8)
<h4>虚拟机(QT creator中)方式</h4>
1.导入工程后先qmake一下</br>
2.选择合适的编译套件(X86-QT4)</br>
3.直接点运行-运行的时候会自动构建</br>

<h3>调试流程</h3>
不单纯指软件,还有相应的硬件调试(需要参考相关文档进行操作)</br>

<h4>1.断点调试</h4>
流程跟踪:

<h4>2.KTV调试</h4>
bug1:透前电导误差导致调试无法进行

<h2>五 移植</h2>
<h3>通常步骤</h3>
1.将生成的hemodialysis通过tftp传到开发板的usr/local/app/目录下 tftp -l hemodialysis -g
源文件IP

<h3>交叉版转虚拟机版</h3>
先在trunk目录下make clean再qmake ，然后运行

<h3>虚拟机版转交叉版</h3>
注意:在CODE/software下先clean.sh再build.sh后的\app-software\trunk下的hemodialysis才能达到4点多m</br>
前提:在虚拟机下正常运行过</br>
说明:trunk目录下的make是单独编译开发板的hemodialysis</br>
app_software目录下的build_app_software.sh与构建文件系统有关(编译出来大小:4.99M左右,会执行qmake脚本)</br>
1.trunk目录下make clean后在app_software目录下build_app_software.sh (直接make会编译出来93M,出错)
-->software目录下的clean.sh不会清理trunk目录下的hemodialysis,trunk目录下执行make clean也清不走

<h3>软件更新方式</h3>
更新注意:移植到开发板需要更新资源文件</br>
0.默认用U盘里的update.pkg进行系统更新</br>
1.网络更新:putty连接ip 192.168.1.165 端口 22 (浏览器浏览方式：http://192.168.1.165:8000/) 用户名root无密码  nfs:挂载虚拟机(客户端)软件目录到开发板</br>
2.SD卡里放入解压出来的可运行更新包</br>
3.串口工具传输(仅在上述情况均失效下采用)

<h3>文件系统</h3>
documents\reference\ UBIFS文档

<h3>移植后(开发板上文件)说明</h3>
usr/local/sbin/目录下有两个脚本文件      分别对移植后在开发板运行的程序进行初始化配置

start.sh</br>
hwclock -s  #将硬件时钟同步到系统时钟   然后挂载驱动  然后再用-qws &命令使程序在后台一直运行</br>

network.sh</br>
/usr/local/bin/sshd</br>
mount -t nfs 192.168.1.141:/home/developer/workspace /mnt -o tcp -o nolock</br>

<h2>六 问题知识库</h2>
总结:不要停止深入理解项目架构;修改代码时不能删除,只能注释掉;接手新项目,应该问的问题(0.项目概念的理解 1.首先要有数据库结构表。看数据库的字段 自己画出流程图。[数据出入上手,上手点2:找板上正确显示的汉字(UI),重点是算法和数据结构]
2。看你项目是什么类型的，结合前台和他的功能要求，看相对应的代码。);开始就做好文档管理工作</br>
1.交叉工具链命名方式 http://www.veryarm.com/296.html   </br>
2.我的bug&开发概念分级 :文件系统级-0 编译级-1  系统移植级-2  电子知识级-3 </br>
3.堆栈理解 http://www.51hei.com/mcu/3799.html </br>
4.电导diàn dǎo[conductance] 表示某一种导体传输电流能力强弱程度。单位是Siemens（西门子），简称西，符号S或Ω-1。电导是用来反映泄漏电流和空气游离所引起的有功功率损耗的一种参数。在输电线路中，电导用来反映线路带电时绝缘介质中产生泄漏电流及导线附近空气游离而产生有功功率损失</br>
5.工具链安装方式:直接连接下载  &  下载源码包编译安装
http://blog.csdn.net/lj402159806/article/details/76408597    暂时装的是3.6.0版本
CMake(跨平台生成makefile文件的编译工具,需要自己手动编写CMakeLists.txt文件)
解压
./bootstrap
make -j8
sudo make install
cmake --version
这种方式可以安装最新版cmake,但是如果想交叉编译用于Android平台的第三方库的话,会在编译时出现问题,因为Android Sdk中提供的交叉编译工具链android.toolchain.cmake还不支持最新版cmake</br>
软链接Android Sdk中的CMake
将Android Sdk中的cmake软链接到/usr/local/bin目录中
sudo ln -s /home/gavinandre/Android/Sdk/cmake/3.6.4111459/bin/cmake /usr/local/bin
</br>
6.环境变量设置多个交叉工具链,不重启也可生效bash.bashrc
<h4>移植级</h4>
1.网线连接故障:开机环境下先连好网线再按复位键才能连通</br>
<h4>编译级</h4>
1:虚拟机qmake项目-1: error: No rule to make target `src/RFCard/*.c', needed by `build/debug_obj/main.o'.  Stop</br>
7.将文件夹生成ext2文件系统镜像的工具genext2fs</br>
8.nfs挂载 input/output error  </br>http://blog.csdn.net/chinalinuxzend/article/details/1836761</br>
http://blog.csdn.net/kevinhg/article/details/5969624</br>
http://blog.csdn.net/cc289123557/article/details/51532018</br>
portmap何时改为rpcbind</br>
nfs使用流程(http://www.cnblogs.com/mchina/archive/2013/01/03/2840040.html):  </br> 
1.服务开启查看 service portmap(rpcbind)/nfs status  </br> 
2.开启服务service nfs start(也可设为开机自动运行) </br> 
红帽及其 关联 发行版本早就用 rpcbind 代替 portmap了，搭建起来也不难啊：
1， yum -y insatll rpcbind nfs-utils
2, vim /etc/exports
/home/network/nfs *(rw,sync,no_root_squash,no_all_squash)
3, exportfs -r
service rpcbind restart
service nfs restart
注意的地方：
1， 你的nfs 目录最好设置成 755
2， 关闭防火墙， vim /etc/sysconfig/selinux
#SELINUX=enforcing
SELINUX=disabled
3, 最好每次开机后自动运行 rpcbind 和 nfs 服务：
# chkconfig nfs on
# chkconfig rpcbind on</br></br>
9.error while loading shared libraries: libGL.so.1: cannot open shared object file: No such file or directory
http://blog.csdn.net/u011132979/article/details/73201234</br>
http://blog.csdn.net/sahusoft/article/details/7388617</br>
程序点了打开没反应->库的设置出问题了</br>
10.RFCard.c no rule to make target-->编译目录不正确</br>
11.触摸屏免调校方案:在目标板里首次烧写时放置记录文件(记录校准后数据),待文件系统(升级前保存,升级时)删除或者开机是自动检测是否存在,不存在才会进入校正界面</br>
12.改动include头文件顺序导致的运行出错 expected unqualified-id before numeric constant</br>
13.移植到Ubuntu下开发注意事项
库可能不同 交叉编译链 X86编译套件也可能不同
解决:通用的库设置</br>
14.cp -fv   强行复制文件或目录，不论目标文件或目录是否已存在,详细显示命令执行的操作。</br>
15.1xargs-由于很多命令不支持|管道来传递参数，而日常工作中有有这个必要，所以就有</br>
<h2>七 功能讨论&后续开发</h2>
<h3>体验优化</h3>
水路图加返回按钮
<h3>平台迁移<h3>
出发问题:①开发板(目标平台需要哪个版本的交叉工具链和QT) ②哪种编译方式最轻便(步骤 维护-迁移&升级)